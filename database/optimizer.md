
《数据库查询优化器的艺术》读书笔记

# 第一章 数据管理系统的查询优化

数据库管理系统的主要功能：数据定义、数据操纵、数据库的运行管理、数据库的建立和维护。

数据库查询优化技术主要包括查询重用技术、查询重写规则、查询算法优化技术、并行查询优化技术、分布式查询优化技术等。

本书重点探讨“查询重写规则”和“查询算法优化”。从优化内容角度看，可以分为代数优化和非代数优化，又称逻辑优化和物理优化。

## 查询重写规则

查询重写是查询语句的一种等价转换，即对任何相关模式的任意状态都会产生相同的结果。

两个目标：
* 将查询转换为等价的、效率更高的形式，例如将效率低的谓词转化为效率高的谓词、消除重复条件等。
* 尽量将查询重写为等价、简单且不受表顺序限制的形式，为物理优化阶段提供更多的选择，如视图的重写、子查询的合并转化等。

查询重写技术优化思路主要包括：
* 将过程性查询转化为描述性的查询，如视图重写
* 将复杂的查询（如嵌套子查询、外连接、嵌套连接）尽可能转换为多表连接查询
* 将效率低的谓词转换为等价的效率高的谓词（如等价谓词重写）
* 利用等式和不等式的性质，简化where、having、on条件


## 查询算法优化

查询优化即求解给定查询语句的高效执行计划的过程。

查询计划，从形式上看是一颗二叉树，树叶是每个单表对象，两个树叶的父节点是一个连接操作符连接后的中间结果，这个结果是一个临时“关系”，这样直至跟节点。

涉及的主要关系节点包括：
* 单表节点。直接通过IO或得数据、通过索引获取数据、通过索引定位数据位置再IO到数据块获取数据。这是一个从物理存储到内存解析成逻辑字段的过程。
* 两表节点。考虑两表以何种方式连接、代价有多大、连接路径有哪些等。表示的是内存中的元组怎么进行元组间的连接。
* 多表中间节点。考虑多表连接顺序如何构成代价最少的执行计划。很多数据库采用左深树、右深树、紧密树3种方式或其中一部分对多表进行连接，等到多种连接路径。

生成最好的查询计划的策略通常有两个：
* 基于规则优化
* 基于成本优化


